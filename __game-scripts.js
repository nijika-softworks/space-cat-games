pc.DEFAULT_HUMAN_HEIGHT=1.67,function(){pc.util={},pc.util.DEBUG=!1,pc.util.DEFAULT_VEC3_0=new pc.Vec3(0,0,0),pc.util.DEFAULT_VEC3_1=new pc.Vec3(1,1,1),pc.util.DEFAULT_QUAT=new pc.Quat(0,0,0,1),pc.util.HIGHLIGHT_ENTITY_GREEN=new pc.Color(.25,.5,.25),pc.util.HIGHLIGHT_ENTITY_RED=new pc.Color(.25,.125,.125),pc.util.HIGHLIGHT_ENTITY_DEFAULT=new pc.Color(0,0,0),pc.util.setEntityAlpha=function(t,n){for(var e=pc.math.clamp(n,0,1),r=pc.util.getMeshInstances(t),i=0;i<r.length;++i)r[i].setParameter("material_opacity",e)},pc.util.setEntityEmissive=function(t,n){for(var e=pc.util.getMeshInstances(t),r=0;r<e.length;++r)e[r].setParameter("material_emissive",n.data3)},pc.util.isMobile=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},pc.util.canPlayOgg=function(){var t=navigator.userAgent.toLowerCase();return!(t.search("safari")>=0&&t.search("chrome")<0)},pc.util.unitCurve=function(t,n){if(1==n)return t;var e=t,r=n-n*e+e;return 0!==r&&(e/=r),e},pc.util.sCurve=function(t){return t*t*(3-2*t)},pc.util.playSoundSlot=function(t,n,e){if(t.sound){var r=t.sound.slots[n];return r&&(e&&(r.volume=e),r.play()),r}return null},pc.util.stopSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];return e&&e.stop(),e}return null},pc.util.pauseSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];return e&&e.pause(),e}return null},pc.util.isPlayingSoundSlot=function(t,n){if(t.sound){var e=t.sound.slots[n];if(e)return e.isPlaying}return!1},pc.util.initSoundSlotAssets=function(t,n){var e=pc.util.canPlayOgg()?".ogg":".mp3",r=n.sound?n.sound.slots:null,i=0;if(r)for(var o in r)if(r.hasOwnProperty(o)){var s=t.assets.find(o+e,"audio");s&&(r[o].asset=s.id,i+=1)}return i};var t=new pc.Vec3;pc.util.getYaw=function(n){var e=t;return n.transformVector(pc.Vec3.FORWARD,e),Math.atan2(-e.x,-e.z)*pc.math.RAD_TO_DEG};var n=new pc.Quat,e=new pc.Quat;pc.util.angleBetweenQuats=function(t,r){var i=n.copy(t).invert(),o=e.mul2(r,i),s=2*Math.acos(pc.math.clamp(o.w,-1,1))*pc.math.RAD_TO_DEG;return s>180&&(s=360-s),s},pc.util.clampQuatToYAxis=function(t){t.x=0,t.z=0;var n=Math.sqrt(t.w*t.w+t.y*t.y);t.w/=n,t.y/=n},pc.util.getMeshInstances=function(t){if(t.model)return t.model.meshInstances;var n=[];if(t instanceof pc.Entity)for(var e=t.findComponents("render"),r=0;r<e.length;++r)for(var i=e[r].meshInstances,o=0;o<i.length;o++)n.push(i[o]);return n}}(),pc.extend(pc,function(){var t=function OrientatedBox(t,n){this.halfExtents=t||new pc.Vec3(.5,.5,.5),this._worldTransform=n||new pc.Mat4,this._modelTransform=this._worldTransform.clone().invert(),this._aabb=new pc.BoundingBox(new pc.Vec3,this.halfExtents)},n=new pc.Ray,e=new pc.Vec3,r=new pc.BoundingSphere;return t.prototype={intersectsRay:function(t,e){if(this._modelTransform.transformPoint(t.origin,n.origin),this._modelTransform.transformVector(t.direction,n.direction),e){var r=this._aabb._intersectsRay(n,e);return this._worldTransform.transformPoint(e,e),r}return modelBox._fastIntersectsRay(this._transformedRay)},containsPoint:function(t){return this._modelTransform.transformPoint(t,e),this._aabb.containsPoint(e)},intersectsBoundingSphere:function(t){return this._modelTransform.transformPoint(t.center,r.center),r.radius=t.radius,!!this._aabb.intersectsBoundingSphere(r)}},Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this._worldTransform},set:function(t){this._worldTransform=t,this._modelTransform.copy(this._worldTransform).invert()}}),{OrientatedBox:t}}()),pc.BoundingSphere.diffBetweenPoints=new pc.Vec3,pc.BoundingSphere.prototype.intersectsBoundingSphere=function(t){var n=pc.BoundingSphere.diffBetweenPoints;n.sub2(t.center,this.center);var e=t.radius+this.radius;return n.lengthSq()<=e*e},pc.BoundingBox.prototype._distanceToBoundingSphereSq=function(t){for(var n=this.getMin(),e=this.getMax(),r=0,i=0;i<3;++i){var o=0,s=t.center.data[i],a=n.data[i],u=e.data[i],c=0;s<a&&(o+=(c=a-s)*c),s>u&&(o+=(c=s-u)*c),r+=o}return r},pc.BoundingBox.prototype.intersectsBoundingSphere=function(t){return this._distanceToBoundingSphereSq(t)<=t.radius*t.radius};var AudioAnalyser=pc.createScript("audioAnalyser");AudioAnalyser.attributes.add("fftsize",{type:"number"}),AudioAnalyser.prototype.assignSoundSlot=function(t){if(t){t.setExternalNodes(this.analyser);var e=this.analyser.minDecibels,s=this.analyser.maxDecibels;this.freqScale=1/(s-e),this.freqOffset=e,this.soundSlot=t}},AudioAnalyser.prototype.initialize=function(){var t=this.app.systems.sound.context;this.analyser=t.createAnalyser(),this.analyser.smoothingTimeConstant=.6,this.analyser.fftSize=this.fftsize,this.freqData=new Float32Array(this.fftsize/2),this.freqScale=0,this.freqOffset=0,this.soundSlot=null},AudioAnalyser.prototype.update=function(t){this.analyser.getFloatFrequencyData(this.freqData)};var RenderLayer=pc.createScript("renderLayer");RenderLayer.attributes.add("layer",{type:"number",default:14,title:"Layer",description:"Has to be between a value of 3 and 14. 3 being the highest priority"}),RenderLayer.prototype.initialize=function(){this.on("attr:layer",(function(e,t){this._setLayer(e)})),this._setLayer(this.layer)},RenderLayer.prototype._setLayer=function(e){e=pc.math.clamp(e,0,15);var t=0,a=pc.util.getMeshInstances(this.entity);if(a)for(t=0;t<a.length;++t)a[t].layer=e;var r=this.entity.particlesystem;r&&r.emitter.meshInstance&&(r.emitter.meshInstance.layer=e);var n=this.entity.element;if(n&&(n._text&&n._text._meshInstance&&(n._text._meshInstance.layer=e),n._image&&(a=n._image._model.meshInstances)))for(t=0;t<a.length;++t)a[t].layer=e};var ShapeWorld=pc.createScript("shapeWorld");ShapeWorld.prototype.initialize=function(){this._pickableEntities=[],this._pickableShapes=[],this.app.on("shapeworld:add",this.addItem,this),this.app.on("shapeworld:remove",this.removeItem,this),this.app.shapeWorld=this},ShapeWorld.hitPoint=new pc.Vec3,ShapeWorld.vecBetween=new pc.Vec3,ShapeWorld.prototype.raycast=function(e,t,i,p){for(var a=ShapeWorld.hitPoint,s=(ShapeWorld.vecBetween,p||1/0),h=null,n=0;n<this._pickableShapes.length;++n){var r=this._pickableShapes[n],o=this._pickableEntities[n];if((!t||t(o)&&o.enabled)&&r.intersectsRay(e,a)){var l=e.origin.distance(a);l<s&&(s=l,h=o,i&&i.copy(a))}}return h},ShapeWorld.prototype.containsPoint=function(e,t){for(var i=null,p=0;p<this._pickableShapes.length;++p){var a=this._pickableShapes[p],s=this._pickableEntities[p];if((!t||t(s)&&s.enabled)&&a.containsPoint(e)){i=s;break}}return i},ShapeWorld.prototype.intersectsSphere=function(e,t){for(var i=null,p=0;p<this._pickableShapes.length;++p){var a=this._pickableShapes[p],s=this._pickableEntities[p];if((!t||t(s)&&s.enabled)&&a.intersectsBoundingSphere(e)){i=s;break}}return i},ShapeWorld.prototype.addItem=function(e,t){e&&(this._pickableEntities.push(e),this._pickableShapes.push(t))},ShapeWorld.prototype.removeItem=function(e){var t=this._items.indexOf(e);t>=0&&(this._pickableEntities.splice(t,1),this._pickableShapes.splice(t,1))};var Shape=pc.createScript("shape");Shape.attributes.add("type",{type:"string",enum:[{Sphere:"sphere"},{AABB:"aabb"},{OBB:"obb"}],default:"sphere",title:"Type"}),Shape.attributes.add("childOfActualEntity",{type:"boolean",default:!1,title:"Child Of Actual Entity",description:"Tick if the shape is a child of the actual entity object"}),Shape.attributes.add("keepUpdating",{type:"boolean",default:!1,title:"Keep Updating",description:"Update the shape data every frame (only toggle if the entity moves as can be expensive)"}),Shape.attributes.add("addToObject",{type:"string",enum:[{Global:"app"},{"Actual Entity":"actualEntity"}],title:"Add to Object",default:"app"}),Shape.prototype.initialize=function(){switch(this._halfExtents=this.entity.getLocalScale().clone().scale(.5),this.type){case"sphere":this._shape=new pc.BoundingSphere(this.entity.getPosition().clone(),Math.max(this._halfExtents.x,Math.max(this._halfExtents.y,this._halfExtents.z)));break;case"aabb":this._shape=new pc.BoundingBox(this.entity.getPosition().clone(),this._halfExtents);break;case"obb":this._worldTransform=(new pc.Mat4).setTRS(this.entity.getPosition(),this.entity.getRotation(),pc.util.DEFAULT_VEC3_1),this._shape=new pc.OrientatedBox(this._halfExtents,this._worldTransform)}},Shape.prototype.postInitialize=function(){this._getAddToObject().fire("shapeworld:add",this._getActualEntity(),this._shape),this.on("state",this._onStateChanged,this)},Shape.prototype.update=function(t){if(this.keepUpdating)switch(this.type){case"sphere":case"aabb":this._shape.center.copy(this.entity.getPosition());break;case"obb":this._worldTransform.setTRS(this.entity.getPosition(),this.entity.getRotation(),pc.util.DEFAULT_VEC3_1),this._shape.worldTransform=this._worldTransform}},Shape.prototype._onStateChanged=function(t){var e=this._getAddToObject();t?e.fire("shapeworld:add",this._getActualEntity(),this._shape):e.fire("shapeworld:remove",this._getActualEntity(),this._shape)},Shape.prototype._getAddToObject=function(){switch(this.addToObject){case"app":return this.app;case"actualEntity":return this._getActualEntity();default:return null}},Shape.prototype._getActualEntity=function(){return this.childOfActualEntity?this.entity.parent:this.entity};var Button=pc.createScript("button");Button.attributes.add("coolDownTime",{type:"number",default:1,title:"Cool Down Time (secs)"}),Button.STATE_IDLE="IDLE",Button.STATE_ACTIVATED="ACTIVATED",Button.prototype.initialize=function(){this.entity.on("object:interact",this._onInteract,this),this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this._state=Button.STATE_IDLE,this._secsSinceActivation=0},Button.prototype.update=function(t){switch(this._state){case Button.STATE_IDLE:break;case Button.STATE_ACTIVATED:this._secsSinceActivation+=t,this._secsSinceActivation>=this.coolDownTime&&(this.entity.fire("button:reseted"),this._state=Button.STATE_IDLE)}},Button.controllerMovementDirection=new pc.Vec2,Button.DOT_THRESHOLD=-.3,Button.prototype._onInteract=function(t){if(this._isIdle()){var i=Button.controllerMovementDirection.copy(this.entity.up);i.scale(-1),t.getMovementDirection&&i.copy(t.getMovementDirection()),i.dot(this.entity.up)<=Button.DOT_THRESHOLD&&(this.entity.fire("button:activated"),this._secsSinceActivation=0,this._state=Button.STATE_ACTIVATED,this._removeHighlight(this.entity))}},Button.prototype._onHover=function(){this._isIdle()&&this._addHighlight(this.entity)},Button.prototype._offHover=function(){this._isIdle()&&this._removeHighlight(this.entity)},Button.prototype._isIdle=function(){return this._state==Button.STATE_IDLE},Button.prototype._addHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN);for(var i=t.children,e=0;e<i.length;++e)this._addHighlight(i[e])},Button.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var i=t.children,e=0;e<i.length;++e)this._removeHighlight(i[e])};var ControllerTrigger=pc.createScript("controllerTrigger");ControllerTrigger.attributes.add("coolDownTime",{type:"number",default:1,title:"Cool Down Time (secs)"}),ControllerTrigger.STATE_IDLE="IDLE",ControllerTrigger.STATE_ACTIVATED="ACTIVATED",ControllerTrigger.prototype.initialize=function(){this.entity.on("object:interact",this._onInteract,this),this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this._state=ControllerTrigger.STATE_IDLE,this._secsSinceActivation=0},ControllerTrigger.prototype.update=function(t){switch(this._state){case ControllerTrigger.STATE_IDLE:break;case ControllerTrigger.STATE_ACTIVATED:this._secsSinceActivation+=t,this._secsSinceActivation>=this.coolDownTime&&(this.entity.fire("controllertrigger:reseted"),this._state=ControllerTrigger.STATE_IDLE)}},ControllerTrigger.controllerMovementDirection=new pc.Vec2,ControllerTrigger.DOT_THRESHOLD=-.3,ControllerTrigger.prototype._onInteract=function(t){this._isIdle()&&(this.entity.fire("controllertrigger:activated"),this._secsSinceActivation=0,this._state=ControllerTrigger.STATE_ACTIVATED,this._removeHighlight(this.entity))},ControllerTrigger.prototype._onHover=function(){this._isIdle()&&this._addHighlight(this.entity)},ControllerTrigger.prototype._offHover=function(){this._isIdle()&&this._removeHighlight(this.entity)},ControllerTrigger.prototype._isIdle=function(){return this._state==ControllerTrigger.STATE_IDLE},ControllerTrigger.prototype._addHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN);for(var e=t.children,r=0;r<e.length;++r)this._addHighlight(e[r])},ControllerTrigger.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var e=t.children,r=0;r<e.length;++r)this._removeHighlight(e[r])};var DoorHandle=pc.createScript("doorHandle");DoorHandle.attributes.add("side",{type:"string",enum:[{left:"left"},{right:"right"}],default:"left",title:"Side"}),DoorHandle.attributes.add("numberShakes",{type:"number",default:1,title:"Number of Shakes"}),DoorHandle.attributes.add("animLength",{type:"number",default:1,title:"Animation Length (secs)"}),DoorHandle.attributes.add("rotateRange",{type:"number",default:0,title:"",description:"Rotate Range (degress)"}),DoorHandle.prototype.initialize=function(){pc.util.initSoundSlotAssets(this.app,this.entity),this.secsSinceActivation=0,this.entity.on("controllertrigger:activated",this._onActivated,this)},DoorHandle.SIN_SCALE=1.3,DoorHandle.prototype.update=function(t){var e=Math.min(this.secsSinceActivation/this.animLength,1),i=pc.math.clamp(Math.sin(e*(Math.PI*this.numberShakes))*DoorHandle.SIN_SCALE,-1,1)*this.rotateRange;"right"==this.side&&(i*=-1),this.entity.setLocalEulerAngles(0,0,i),this.secsSinceActivation+=t},DoorHandle.prototype._onActivated=function(){this.secsSinceActivation=0,pc.util.playSoundSlot(this.entity,"locked-room-doors")};var Grabbable=pc.createScript("grabbable");Grabbable.STATE_IDLE="IDLE",Grabbable.STATE_RESET_TELEPORT_OUT="RESET_TELEPORT_OUT",Grabbable.STATE_RESET_TELEPORT_IN="RESET_TELEPORT_IN",Grabbable.STATE_IN_USE_WITH="IN_USE_WITH",Grabbable.prototype.initialize=function(){this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this.entity.on("object:hold",this._onHold,this),this.entity.on("object:release",this._onRelease,this),this._controller=null,this._grabRotationOffset=new pc.Quat,this._wasGrabbed=!1,this._secsSinceReleased=0,this._yPositionWhenStopped=0,this._startLocalTransform=this.entity.getLocalTransform().clone(),this._state=Grabbable.STATE_IDLE,this._secsSinceStateChange=0,this._prevPosition=(new pc.Vec3).copy(this.entity.getPosition()),this._releasedVelocity=new pc.Vec3,this._positionWithoutBob=(new pc.Vec3).copy(this.entity.getPosition())},Grabbable.RESET_TIMEOUT=10,Grabbable.BOB_HEIGHT=.1,Grabbable.BOB_ANIM_LENGTH=4,Grabbable.prototype.postUpdate=function(t){switch(this._secsSinceStateChange+=t,this._state){case Grabbable.STATE_IDLE:this._updateStateIdle(t);break;case Grabbable.STATE_RESET_TELEPORT_OUT:this._updateStateResetTeleportOut(t);break;case Grabbable.STATE_RESET_TELEPORT_IN:this._updateStateResetTeleportIn(t)}},Grabbable.prototype._changeState=function(t){this._secsSinceStateChange=0,this._state=t},Grabbable.DECELERATION_TIME=1,Grabbable.DECELERATION_CURVE=.9,Grabbable.DELAY_BEFORE_BOB=.3,Grabbable.velocity=new pc.Vec3,Grabbable.newPosition=new pc.Vec3,Grabbable.updatedRotation=new pc.Quat,Grabbable.prototype._updateStateIdle=function(t){Grabbable.updatedRotation;var e=Grabbable.velocity,a=Grabbable.newPosition;if(this._prevPosition.copy(this.entity.getPosition()),this._controller)this._controller.updateAttachment(this.entity,this._grabRotationOffset);else if(this._wasGrabbed){this._secsSinceReleased+=t;var i=Math.min(this._secsSinceReleased/Grabbable.DECELERATION_TIME,1);if(e.lerp(this._releasedVelocity,pc.util.DEFAULT_VEC3_0,pc.util.unitCurve(i,Grabbable.DECELERATION_CURVE)),e.scale(t),this._secsSinceReleased<=Grabbable.DECELERATION_TIME&&this._positionWithoutBob.add(e),a.copy(this._positionWithoutBob),this._secsSinceReleased>=Grabbable.DELAY_BEFORE_BOB){var s=(this._secsSinceReleased-Grabbable.DELAY_BEFORE_BOB)%Grabbable.BOB_ANIM_LENGTH/Grabbable.BOB_ANIM_LENGTH*(2*Math.PI),b=Math.sin(s)*Grabbable.BOB_HEIGHT;a.y+=b}this.entity.setPosition(a),this._secsSinceReleased>=Grabbable.RESET_TIMEOUT&&(this._removeHighlight(this.entity),this._changeState(Grabbable.STATE_RESET_TELEPORT_OUT))}},Grabbable.TELEPORT_ANIM_LENGTH=.2,Grabbable.SMALLEST_SCALE=new pc.Vec3(.001,.001,.001),Grabbable.updatedScale=new pc.Vec3,Grabbable.prototype._updateStateResetTeleportOut=function(t){var e=Math.min(this._secsSinceStateChange/Grabbable.TELEPORT_ANIM_LENGTH,1),a=Grabbable.updatedScale;a.lerp(this._startLocalTransform.getScale(),Grabbable.SMALLEST_SCALE,e),this.entity.setLocalScale(a),this._secsSinceStateChange>=Grabbable.TELEPORT_ANIM_LENGTH&&(this.entity.setLocalPosition(this._startLocalTransform.getTranslation()),this.entity.setLocalEulerAngles(this._startLocalTransform.getEulerAngles()),this._changeState(Grabbable.STATE_RESET_TELEPORT_IN))},Grabbable.prototype._updateStateResetTeleportIn=function(t){var e=Math.min(this._secsSinceStateChange/Grabbable.TELEPORT_ANIM_LENGTH,1),a=Grabbable.updatedScale;a.lerp(Grabbable.SMALLEST_SCALE,this._startLocalTransform.getScale(),e),this.entity.setLocalScale(a),this._secsSinceStateChange>=Grabbable.TELEPORT_ANIM_LENGTH&&(this._secsSinceReleased=0,this._wasGrabbed=!1,this._changeState(Grabbable.STATE_IDLE))},Grabbable.prototype._onHover=function(){this._isIdle()&&this._addHighlight(this.entity)},Grabbable.prototype._offHover=function(){this._isIdle()&&this._removeHighlight(this.entity)},Grabbable.prototype._onHold=function(t){this._isIdle()&&(this._controller&&this._controller.detach(this.entity),this._controller=t,this._grabRotationOffset.copy(t.getAttachRotation()).invert().mul(this.entity.getRotation()),t.attach(this.entity),this._removeHighlight(this.entity))},Grabbable.RELEASE_VELOCITY_FACTOR=10,Grabbable.MAX_RELEASE_VELOCITY=2.5,Grabbable.prototype._onRelease=function(t){this._isIdle()&&(this._controller==t&&(this._controller.detach(this.entity),this._controller=null,this._secsSinceReleased=0,this._wasGrabbed=!0,this._releasedVelocity.sub2(this.entity.getPosition(),this._prevPosition).scale(Grabbable.RELEASE_VELOCITY_FACTOR),this._releasedVelocity.length()>Grabbable.MAX_RELEASE_VELOCITY&&this._releasedVelocity.normalize().scale(Grabbable.MAX_RELEASE_VELOCITY),this._positionWithoutBob.copy(this.entity.getPosition())))},Grabbable.prototype._hasMoved=function(){return this._wasGrabbed},Grabbable.prototype._isIdle=function(){return this._state==Grabbable.STATE_IDLE},Grabbable.prototype._addHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN);for(var e=t.children,a=0;a<e.length;++a)this._addHighlight(e[a])},Grabbable.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var e=t.children,a=0;a<e.length;++a)this._removeHighlight(e[a])};var Hifi=pc.createScript("hifi");Hifi.attributes.add("rotateSpeed",{type:"number",default:10,title:"Rotate Speed"}),Hifi.attributes.add("leftSpeakerEntity",{type:"entity",title:"Left Speaker Entity"}),Hifi.attributes.add("rightSpeakerEntity",{type:"entity",title:"Right Speaker Entity"}),Hifi.attributes.add("idleNeedleRotation",{type:"number",default:0,title:"Idle Needle Rotation"}),Hifi.attributes.add("startNeedleRotation",{type:"number",default:0,title:"Start Needle Rotation"}),Hifi.attributes.add("endNeedleRotation",{type:"number",default:0,title:"End Needle Rotation"}),Hifi.prototype.initialize=function(){pc.util.initSoundSlotAssets(this.app,this.entity),this.entity.on("interactswith:attachobject",this._onAttachObject,this),this.entity.on("interactswith:detachobject",this._onDetachObject,this),this._attachPointEntity=this.entity.findByName("Attach Point"),this._interactsWith=this.entity.script.interactsWith,this._currentNeedleRotation=this.idleNeedleRotation,this._rangeNeedleRotation=this.endNeedleRotation-this.startNeedleRotation,this._soundSlot=null,this._speakerCones=[];var t=0,e=this.leftSpeakerEntity.children;for(t=0;t<e.length;++t)childScript=e[t].script,childScript&&childScript.speakerCone&&this._speakerCones.push(childScript.speakerCone);for(e=this.rightSpeakerEntity.children,t=0;t<e.length;++t)childScript=e[t].script,childScript&&childScript.speakerCone&&this._speakerCones.push(childScript.speakerCone);this._needleModel=this.entity.findByName("Needle Model")},Hifi.VOLUME_CAP=55,Hifi.NEEDLE_LERP_FACTOR=12,Hifi.conePosition=new pc.Vec3,Hifi.prototype.update=function(t){this._attachPointEntity.rotateLocal(0,this.rotateSpeed*t,0);var e=this.idleNeedleRotation;if(null!==this._soundSlot){var i=0,n=this.entity.script.audioAnalyser,s=n.freqData,o=0;for(i=0;i<s.length;++i){var a=(s[i]-n.freqOffset)*n.freqScale;o+=a>0?a:0}var l=Math.min(o,Hifi.VOLUME_CAP)/Hifi.VOLUME_CAP;for(i=0;i<this._speakerCones.length;++i)this._speakerCones[i].applyVolume(l);if(this._soundSlot.instances&&this._soundSlot.instances[0]){var r=this._soundSlot.instances[0].currentTime,h=this._soundSlot.instances[0].duration;if(h>0){var d=r/h;e=this._rangeNeedleRotation*d+this.startNeedleRotation}}}this._currentNeedleRotation=pc.math.lerp(this._currentNeedleRotation,e,Math.min(Hifi.NEEDLE_LERP_FACTOR*t,1)),this._needleModel.setLocalEulerAngles(0,this._currentNeedleRotation,0)},Hifi.prototype._onAttachObject=function(t){var e=t.getHeldEntity(),i=e.script?e.script.vinyl:null,n=this.entity.script.audioAnalyser;i&&(this._soundSlot=pc.util.playSoundSlot(this.entity,i.soundSlotName),this._soundSlot&&n.assignSoundSlot(this._soundSlot))},Hifi.prototype._onDetachObject=function(t){this._soundSlot&&(pc.util.stopSoundSlot(this.entity,this._soundSlot.name),this._soundSlot=null);for(var e=0;e<this._speakerCones.length;++e)this._speakerCones[e].applyVolume(0)};var InteractsWith=pc.createScript("interactsWith");InteractsWith.attributes.add("presetEntity",{type:"entity",title:"Preset Entity",description:"Entity to be attached to this on start"}),InteractsWith.attributes.add("compatibleTag",{type:"string",default:"",title:"Compatible Tag",description:"Tag that this object can interact with"}),InteractsWith.STATE_IDLE="IDLE",InteractsWith.STATE_IN_USE="IN_USE",InteractsWith.prototype.attach=function(t){this._heldEntity=t,this.entity.fire("interactswith:attachobject",this),this._state=InteractsWith.STATE_IN_USE},InteractsWith.prototype.detach=function(t){this.entity.fire("interactswith:detachobject",this),this._heldEntity=null,this._state=InteractsWith.STATE_IDLE},InteractsWith.prototype.getAttachPosition=function(){return this._attachPointEntity.getPosition()},InteractsWith.prototype.getAttachRotation=function(){return this._attachPointEntity.getRotation()},InteractsWith.prototype.updateAttachment=function(t,i){t.setPosition(this._attachPointEntity.getPosition()),t.setRotation(this._attachPointEntity.getRotation())},InteractsWith.prototype.getHeldEntity=function(){return this._heldEntity},InteractsWith.prototype.initialize=function(){this._heldEntity=null,this._state=InteractsWith.STATE_IDLE,this.entity.on("object:onhover",this._onHover,this),this.entity.on("object:offhover",this._offHover,this),this.entity.on("object:attemptuse",this._onAttemptUse,this),this._attachPointEntity=this.entity.findByName("Attach Point")},InteractsWith.prototype.postInitialize=function(){this.presetEntity&&this._isCompatible(this.presetEntity)&&this.presetEntity.fire("object:hold",this)},InteractsWith.prototype.update=function(t){switch(this._state){case InteractsWith.STATE_IDLE:this._updateStateIdle(t);break;case InteractsWith.STATE_IN_USE:this._updateStateInUse(t)}},InteractsWith.prototype._updateStateIdle=function(t){},InteractsWith.prototype._updateStateInUse=function(t){},InteractsWith.prototype._onHover=function(t){if(this._isIdle()){var i=t.getHeldEntity();i?this._isCompatible(i)?this._addHighlight(this.entity,!0):this._addHighlight(this.entity,!1):this._removeHighlight(this.entity)}},InteractsWith.prototype._offHover=function(t){this._isIdle()&&this._removeHighlight(this.entity)},InteractsWith.prototype._onAttemptUse=function(t){if(this._isIdle()){var i=t.getHeldEntity();this._isCompatible(i)?i.fire("object:hold",this):i.fire("object:release",t),this._removeHighlight(this.entity)}},InteractsWith.prototype._isIdle=function(){return this._state==InteractsWith.STATE_IDLE},InteractsWith.prototype._isCompatible=function(t){return!(!t||!t.tags.has(this.compatibleTag))},InteractsWith.prototype._addHighlight=function(t,i){i?pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_GREEN):pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_RED);for(var e=t.children,n=0;n<e.length;++n)this._addHighlight(e[n],i)},InteractsWith.prototype._removeHighlight=function(t){pc.util.setEntityEmissive(t,pc.util.HIGHLIGHT_ENTITY_DEFAULT);for(var i=t.children,e=0;e<i.length;++e)this._removeHighlight(i[e])};var LocatorRings=pc.createScript("locatorRings");LocatorRings.attributes.add("animLength",{type:"number",default:1,title:"Anim Length (secs)"}),LocatorRings.attributes.add("loopGap",{type:"number",default:1,title:"Loop Gap (secs)"}),LocatorRings.attributes.add("yOffsetCurve",{type:"curve",title:"Y Offset Curve"}),LocatorRings.attributes.add("scaleOffsetCurve",{type:"curve",title:"Scale Offset Curve"}),LocatorRings.attributes.add("alphaCurve",{type:"curve",title:"Alpha Curve"}),LocatorRings.prototype.initialize=function(){this._rings=this.entity.findByTag("locator-ring"),this._ringCount=this._rings.length,this._time=0,this._targetScaleY=1,this._setScaleY(.001),this.on("state",this._onStateChanged,this)},LocatorRings.ringPosition=new pc.Vec3,LocatorRings.SCALE_LERP_FACTOR=8,LocatorRings.prototype.update=function(t){var e=this._time/this.animLength,i=LocatorRings.ringPosition;LocatorRings.ringScale;if(e<=1)for(var a=0;a<this._ringCount;++a){var s=(e+1/this._ringCount*a)%1,o=this._rings[a];i.copy(o.getLocalPosition()),i.y=this.yOffsetCurve.value(s),o.setLocalPosition(i);var n=this.scaleOffsetCurve.value(s);o.setLocalScale(n,n,n),pc.util.setEntityAlpha(o,this.alphaCurve.value(s))}this._time=(this._time+t)%(this.animLength+this.loopGap);var r=this.entity.getLocalScale();this._setScaleY(pc.math.lerp(r.y,this._targetScaleY,Math.min(LocatorRings.SCALE_LERP_FACTOR*t,1)))},LocatorRings.prototype._onStateChanged=function(t){t&&(this._setScaleY(.001),this._targetScaleY=1)},LocatorRings.prototype._setScaleY=function(t){var e=this.entity.getLocalScale();e.y=t,this.entity.setLocalScale(e)};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseSensivity",{title:"Mouse Sensivity",type:"number",default:.3}),LookCamera.attributes.add("controllerTemplate",{title:"Controller Template",type:"asset",assetType:"template"}),LookCamera.prototype.initialize=function(){this._offsetParent=this.entity.parent;var t=this.entity.getRotation();this.yaw=pc.util.getYaw(t),this.pitch=this._getPitch(t,this.yaw),this.movedMouse=0,this.movedStart=0,this.touchCoords=new pc.Vec2,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this._onMouseMove,this),this.app.mouse.disableContextMenu(),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this._onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this._onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this._onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this._onTouchMove,this)),this.app.mainCamera=this.entity,this.gazeController=null,this.app.xr.active||(this.gazeController=this.controllerTemplate.resource.instantiate(),this.gazeController.reparent(this.app.root),this.gazeController.enabled=!0),this.app.xr.on("start",(function(){this.gazeController&&(this.gazeController.destroy(),this.gazeController=null)}),this),this.app.xr.on("end",(function(){this.gazeController||(this.gazeController=this.controllerTemplate.resource.instantiate(),this.gazeController.reparent(this.app.root),this.gazeController.enabled=!0)}),this)},LookCamera.prototype._onMouseDown=function(t){this.app.xr.active||(pc.Mouse.isPointerLocked()||t.event.target.id&&"application-canvas"==t.event.target.id&&this.app.mouse.enablePointerLock(),t.button===pc.MOUSEBUTTON_LEFT&&(this.movedStart=Date.now(),this.movedMouse=0,this.gazeController&&this.gazeController.script.controller.onSelectStart()))},LookCamera.prototype._onTouchStart=function(t){this.app.xr.active||(t.event.preventDefault(),1===t.touches.length&&(this.movedStart=Date.now(),this.movedMouse=0,this.touchCoords.set(t.touches[0].x,t.touches[0].y),this.gazeController&&(this.gazeController.script.controller.active=!0,this.gazeController.script.controller.mouseCoords.set(t.touches[0].x,t.touches[0].y),this.gazeController.script.controller.onSelectStart())))},LookCamera.prototype._onMouseUp=function(t){this.app.xr.active||t.button===pc.MOUSEBUTTON_LEFT&&this.gazeController&&(!pc.Mouse.isPointerLocked()&&(this.movedMouse>30||Date.now()-this.movedStart>300)&&(this.gazeController.script.controller.teleportable=!1),this.gazeController.script.controller.onSelectEnd(),this.gazeController.script.controller.teleportable=!0)},LookCamera.prototype._onTouchEndCancel=function(t){this.app.xr.active||0===t.touches.length&&this.gazeController&&((this.movedMouse>30||Date.now()-this.movedStart>300)&&(this.gazeController.script.controller.teleportable=!1),this.gazeController.script.controller.onSelectEnd(),this.gazeController.script.controller.teleportable=!0,this.gazeController.script.controller.active=!1)},LookCamera.prototype._onMouseMove=function(t){this.app.xr.active||(this.gazeController&&(this.gazeController.script.controller.mouseCoords.set(t.x,t.y),this.gazeController.script.controller.active=!0),!pc.Mouse.isPointerLocked()&&(!this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)||this.gazeController&&this.gazeController.script.controller.getHeldEntity())||(this.pitch=Math.max(-90,Math.min(90,this.pitch-t.dy*this.mouseSensivity)),this.yaw-=t.dx*this.mouseSensivity,this.movedMouse+=Math.abs(t.dy)+Math.abs(t.dx)))},LookCamera.prototype._onTouchMove=function(t){if(!this.app.xr.active&&1===t.touches.length&&(this.gazeController&&this.gazeController.script.controller.mouseCoords.set(t.touches[0].x,t.touches[0].y),!this.gazeController||!this.gazeController.script.controller.getHeldEntity())){var e=t.touches[0].x-this.touchCoords.x,o=t.touches[0].y-this.touchCoords.y;this.touchCoords.set(t.touches[0].x,t.touches[0].y),this.pitch=Math.max(-90,Math.min(90,this.pitch-o*this.mouseSensivity)),this.yaw-=e*this.mouseSensivity,this.movedMouse+=Math.abs(o)+Math.abs(e)}},LookCamera.prototype.update=function(t){this._offsetParent.setLocalEulerAngles(0,this.yaw,0),this.app.xr.active||this.entity.setLocalEulerAngles(this.pitch,0,0)},LookCamera.quatWithoutYaw=new pc.Quat,LookCamera.yawOffset=new pc.Quat,LookCamera.prototype._getPitch=function(t,e){var o=LookCamera.quatWithoutYaw,s=LookCamera.yawOffset;s.setFromEulerAngles(0,-e,0),o.mul2(s,t);var r=new pc.Vec3;return o.transformVector(pc.Vec3.FORWARD,r),Math.atan2(r.y,-r.z)*pc.math.RAD_TO_DEG};var SpeakerCone=pc.createScript("speakerCone");SpeakerCone.MAX_DISPLACEMENT=.02,SpeakerCone.MAX_SCALE_RANGE=.1,SpeakerCone.volumeDisplacement=new pc.Vec3,SpeakerCone.volumeScale=new pc.Vec3,SpeakerCone.prototype.applyVolume=function(e){var t=SpeakerCone.volumeDisplacement;t.copy(this.entity.forward).scale(e*SpeakerCone.MAX_DISPLACEMENT),t.add(this._startLocalPosition);var a=SpeakerCone.volumeScale,o=SpeakerCone.MAX_SCALE_RANGE*e;o+=pc.math.random(-SpeakerCone.MAX_DISPLACEMENT/5,SpeakerCone.MAX_DISPLACEMENT/5),a.set(o,o,o),a.add(this._startLocalScale),this.entity.setLocalPosition(t),this.entity.setLocalScale(a)},SpeakerCone.prototype.initialize=function(){this._startLocalPosition=this.entity.getLocalPosition().clone(),this._startLocalScale=this.entity.getLocalScale().clone()};var StatueButton=pc.createScript("statueButton");StatueButton.attributes.add("startPosition",{type:"vec3",default:[0,0,0],title:"Start Position"}),StatueButton.attributes.add("pressedPosition",{type:"vec3",default:[0,0,0],title:"Pressed Position"}),StatueButton.attributes.add("statueEntity",{type:"entity",title:"Statue Entity"}),StatueButton.prototype.initialize=function(){this.entity.on("button:activated",this._onButtonActivated,this),this.entity.on("button:reseted",this._onButtonReseted,this),this._model=this.entity.findByName("Model"),this._activated=!1},StatueButton.LERP_FACTOR=18,StatueButton.prototype.update=function(t){var e=this._model.getLocalPosition();this._activated?e.lerp(e,this.pressedPosition,Math.min(StatueButton.LERP_FACTOR*t,1)):e.lerp(e,this.startPosition,Math.min(StatueButton.LERP_FACTOR*t,1)),this._model.setLocalPosition(e)},StatueButton.prototype._onButtonActivated=function(){this.statueEntity.fire("statue:activate"),this._activated=!0},StatueButton.prototype._onButtonReseted=function(){this._activated=!1};var Statue=pc.createScript("statue");Statue.attributes.add("soundSlotName",{type:"string",default:"",title:"Sound Slot Name"}),Statue.prototype.initialize=function(){this._audioEntity=this.entity.findByName("Sound"),pc.util.initSoundSlotAssets(this.app,this._audioEntity),this._particles=this.entity.findByName("Particle System"),this.entity.on("statue:activate",this._onActivate,this)},Statue.prototype._onActivate=function(){pc.util.playSoundSlot(this._audioEntity,this.soundSlotName),this._secsSinceActivation=0,this._playParticleEffect(this._particles)},Statue.prototype._playParticleEffect=function(t){for(var i=t.children,e=0;e<i.length;e++)i[e].particlesystem.reset(),i[e].particlesystem.play()};var Vinyl=pc.createScript("vinyl");Vinyl.attributes.add("soundSlotName",{type:"string",default:"",title:"Sound Slot Name",description:"Name of slot to play on Hifi"});var Vr=pc.createScript("vr");Vr.attributes.add("buttonVr",{type:"entity",title:"VR Button"}),Vr.attributes.add("elementUnsupported",{type:"entity",title:"Unsupported Message"}),Vr.attributes.add("elementUnavailable",{type:"entity",title:"Unavailable Message"}),Vr.attributes.add("elementHttpsRequired",{type:"entity",title:"HTTPS Required Message"}),Vr.attributes.add("cameraEntity",{type:"entity",title:"Camera"}),Vr.prototype.initialize=function(){this.app.xr.on("available:"+pc.XRTYPE_VR,this.checkButton,this),this.app.xr.on("start",this.checkButton,this),this.app.xr.on("end",this.checkButton,this),this.buttonVr.element.on("click",(function(){this.sessionStart()}),this),this.app.keyboard.on("keydown",(function(t){t.key===pc.KEY_ESCAPE&&this.app.xr.active&&this.app.xr.end()}),this),this.checkButton(!1),this.setEvents("on"),this.on("destroy",(function(){this.setEvents("off")}),this)},Vr.prototype.setEvents=function(t){this.app.xr[t]("available:"+pc.XRTYPE_VR,this.onAvailable,this),this.app.xr[t]("start",this.onStart,this),this.app.xr[t]("end",this.onEnd,this)},Vr.prototype.checkButton=function(t){this.app.xr.supported?(this.elementHttpsRequired.enabled=!1,this.elementUnsupported.enabled=!1,this.elementUnavailable.enabled=!1,this.buttonVr.enabled=!t):(this.buttonVr.enabled=!1,this.elementUnavailable.enabled=!1,"https:"==window.location.protocol?(this.elementUnsupported.enabled=!0,this.elementHttpsRequired.enabled=!1):(this.elementUnsupported.enabled=!1,this.elementHttpsRequired.enabled=!0))},Vr.prototype.sessionStart=function(){this.app.xr.supported&&(this.app.xr.active||this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(t){"granted"===t&&window.addEventListener("deviceorientation",function(t){this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)}.bind(this))}.bind(this)).catch(console.error):this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)))},Vr.prototype.onAvailable=function(){this.checkButton(!1)},Vr.prototype.onStart=function(){this.checkButton(!0)},Vr.prototype.onEnd=function(){this.checkButton(!1)};var Controllers=pc.createScript("controllers");Controllers.attributes.add("controllerTemplate",{type:"asset",assetType:"template",title:"Controller Template"}),Controllers.prototype.initialize=function(){this.controllerAssets=this.app.assets.findByTag("controller"),this.controllerAssetsIndex={};for(var e=0;e<this.controllerAssets.length;e++){var t=this.controllerAssets[e].name.replace(/\.[a-z]+$/i,"");this.controllerAssetsIndex[t]=this.controllerAssets[e]}this.app.xr.input.on("add",(function(e){for(var t=this.controllerTemplate.resource.instantiate(),r=null,s=0;s<e.profiles.length;s++){var l=e.profiles[s]+"-"+e.handedness;if(r=this.controllerAssetsIndex[l])break}r||(r=this.controllerAssetsIndex["generic-trigger-"+(e.handedness||"none")]),t.reparent(this.app.root),t.script.controller.setInputSource(e,r),t.enabled=!0}),this)};var Controller=pc.createScript("controller");Controller.attributes.add("maxGrabDistance",{type:"number",title:"Max Grab Distance",default:.1}),Controller.prototype.initialize=function(){this.ray=new pc.Ray,this.vecA=new pc.Vec3,this.vecB=new pc.Vec3,this.quat=new pc.Quat,this.color=new pc.Color(1,1,1),this.holdingEntity=null,this.teleportableEntity=null,this.hoverEntity=null,this.hoverPoint=new pc.Vec3,this.teleportable=!0,this.active=!0,this.mouseCoords=new pc.Vec2,this.holdingDistance=0,this.holdingOffset=new pc.Vec3,this.holdingNoOffset=!0,this.modelEntity=this.entity.findByName("Model"),this.grabAnchor=new pc.Entity,this.grabAnchor.reparent(this.entity)},Controller.prototype.setInputSource=function(t,i){var e=this;if(this.inputSource=t,this.inputSource.once("remove",this.onRemove,this),this.on("hover",this.onHover,this),this.on("blur",this.onBlur,this),this.inputSource.on("selectstart",this.onSelectStart,this),this.inputSource.on("selectend",this.onSelectEnd,this),t.hand){this.joints=[];for(var o=new pc.StandardMaterial,s=0;s<t.hand.joints.length;s++){var n=t.hand.joints[s],h=new pc.Entity;h.addComponent("model",{type:"box"}),h.joint=n,h.model.material=o,this.joints.push(h),this.entity.addChild(h)}t.hand.on("trackinglost",(function(){this.joints[0].model.material.diffuse.set(1,0,0),this.joints[0].model.material.update()}),this),t.hand.on("tracking",(function(){this.joints[0].model.material.diffuse.set(1,1,1),this.joints[0].model.material.update()}),this)}else i&&(i.ready((function(){if(this.entity.parent){var t=i.resource,o=new Blob([t]);this.app.assets.loadFromUrlAndFilename(URL.createObjectURL(o),"container.glb","container",(function(t,i){if(!e.entity.parent)return i.unload(),void e.app.assets.remove(i);t?console.error(t):(e.modelEntity.setLocalScale(1,1,1),e.modelEntity.model.type="asset",e.modelEntity.model.asset=i.resource.model,e.modelEntity.containerAsset=i)}))}}),this),this.app.assets.load(i))},Controller.prototype.onRemove=function(){this.modelEntity.containerAsset&&(console.log(this.modelEntity.containerAsset),this.modelEntity.containerAsset.unload(),this.app.assets.remove(this.modelEntity.containerAsset),this.modelEntity.containerAsset=null),this.entity.destroy()},Controller.prototype.onSelectStart=function(){this.pick(),this.teleportableEntity?this.app.xr.active&&this.app.fire("teleport:to",this.hoverPoint):this.hoverEntity&&!this.holdingEntity&&(this.hoverEntity.fire("object:interact",this),this.hoverEntity.fire("object:hold",this))},Controller.prototype.onSelectEnd=function(){this.teleportableEntity&&!this.app.xr.active&&this.teleportable&&this.app.fire("teleport:to",this.hoverPoint),this.hoverEntity&&this.hoverEntity.fire("object:attemptuse",this),this.holdingEntity&&this.holdingEntity.fire("object:release",this)},Controller.prototype.getAttachPosition=function(){return this.grabAnchor.getPosition()},Controller.prototype.getAttachRotation=function(){return this.grabAnchor.getRotation()},Controller.prototype.attach=function(t){this.holdingEntity||(this.holdingEntity=t,this.grabAnchor.setPosition(t.getPosition()),this.holdingDistance=t.getPosition().distance(this.app.mainCamera.getPosition()))},Controller.prototype.detach=function(t){this.holdingEntity&&(this.holdingEntity=null)},Controller.prototype.getHeldEntity=function(){return this.holdingEntity},Controller.prototype.updateAttachment=function(t,i){t.setPosition(this.getAttachPosition()),this.quat.mul2(this.getAttachRotation(),i),t.setRotation(this.quat)},Controller.prototype.filterPicker=function(t){return this.holdingEntity!==t},Controller.prototype.pick=function(){this.inputSource?this.ray.set(this.inputSource.getOrigin(),this.inputSource.getDirection()):pc.Mouse.isPointerLocked()?this.ray.set(this.app.mainCamera.getPosition(),this.app.mainCamera.forward):(this.app.mainCamera.camera.screenToWorld(this.mouseCoords.x,this.mouseCoords.y,this.app.mainCamera.camera.nearClip,this.vecA),this.app.mainCamera.camera.screenToWorld(this.mouseCoords.x,this.mouseCoords.y,this.app.mainCamera.camera.farClip,this.vecB),this.vecB.sub(this.vecA).normalize(),this.ray.set(this.vecA,this.vecB),this.holdingEntity?(this.vecB.scale(this.holdingDistance),this.vecB.add(this.vecA),this.holdingNoOffset&&(this.holdingNoOffset=!1,this.holdingOffset.copy(this.grabAnchor.getPosition()).sub(this.vecB)),this.vecB.add(this.holdingOffset),this.grabAnchor.setPosition(this.vecB)):this.holdingNoOffset=!0);var t=this.app.shapeWorld.raycast(this.ray,this.filterPicker.bind(this),this.hoverPoint),i=!1;(this.active||(t=null),this.hoverEntity!==t&&(this.hoverEntity&&this.hoverEntity.fire("object:offhover",this),t&&t.fire("object:onhover",this),this.hoverEntity=t),this.hoverEntity)&&(this.holdingEntity||this.hoverEntity.tags.has("floor")&&this.hoverEntity.up.dot(this.ray.direction)<=0&&(i=!0));this.teleportableEntity=i?this.hoverEntity:null},Controller.prototype.update=function(t){if(this.inputSource&&"gaze"!==this.inputSource.targetRayMode&&(this.vecA.copy(this.inputSource.getOrigin()),this.vecB.copy(this.inputSource.getDirection()),this.vecB.scale(1e3).add(this.vecA),this.inputSource.selecting?this.color.set(0,1,0):this.color.set(1,1,1),this.app.renderLine(this.vecA,this.vecB,this.color)),this.inputSource&&this.inputSource.hand)for(var i=0;i<this.joints.length;i++){var e=this.joints[i].joint,o=2*e.radius;this.joints[i].setLocalScale(o,o,o),this.joints[i].setPosition(e.getPosition()),this.joints[i].setRotation(e.getRotation())}else this.inputSource&&this.inputSource.grip?(this.modelEntity.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation())):(this.modelEntity.enabled=!1,this.inputSource&&"gaze"!==this.inputSource.targetRayMode||(this.entity.setPosition(this.app.mainCamera.getPosition()),this.entity.setRotation(this.app.mainCamera.getRotation())));this.pick(),this.teleportableEntity?(this.vecB.copy(this.hoverEntity.up).scale(.01),this.vecA.copy(this.hoverPoint).add(this.vecB),this.app.fire("teleport:transform",this.vecA,this.hoverEntity.getRotation()),this.app.fire("teleport:show")):this.app.fire("teleport:hide")};var Teleport=pc.createScript("teleport");Teleport.prototype.initialize=function(){this.app.on("teleport:show",(function(){this.entity.enabled=!0}),this),this.app.on("teleport:hide",(function(){this.entity.enabled=!1}),this),this.app.on("teleport:transform",(function(t,e){this.entity.setPosition(t),this.entity.setRotation(e)}),this)};var TeleportCamera=pc.createScript("teleportCamera");TeleportCamera.prototype.initialize=function(){this.app.on("teleport:to",(function(t){this.entity.setPosition(t)}),this)};